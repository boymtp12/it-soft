$(document).ready(function(){checkLogin(),$("#summernote").summernote({placeholder:"Write here..."}),$("#summernote1").summernote({placeholder:"Write here..."}),$("#viewSeo").summernote({placeholder:"Write here..."}),$("#ui-tooltip-0").css({display:"none"}),$("#ui-tooltip-1").css({display:"none"}),$("#ui-tooltip-2").css({display:"none"}),showNameCourseInAddTopic(1),hideShowBlockAddTopic(),showFullTopic(),$("#inputSearchTopic").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;"13"==b&&(""==$("#inputSearchTopic").val()?alertDanger("B\u1EA1n c\u1EA7n nh\u1EADp t\xEAn b\xE0i vi\u1EBFt mu\u1ED1n t\xECm ki\u1EBFm."):searchTopic())})});function showNameCourseInAddTopic(a){let b=``;ajaxCallGet("course/find-all").then(c=>{console.log(c),c.data.map(c=>{b+=c.id==a?`<option value="${c.id}" selected>${c.name}</option> `:`<option value="${c.id}">${c.name}</option> `}),console.log(b),$("#courseOfTopic").html(b)}).catch(()=>{$("#courseOfTopic").html("<option selected> Kh\xF4ng c\xF3 kh\xF3a h\u1ECDc.</option>")})}function postTopic(a){$("#postTopic").prop("disabled",!0),console.log($("#summernote").summernote("code")),console.log($("#summernote1").summernote("code"));let b=getSeoTopic();console.log(b);let c=null,d=$("#tagTopic").val().replaceAll("#"," ").split(" "),e=null,f=getItemLocalStorage("user").data.id;c=0==a?{title:$("#titleTopic").val(),introduct:$("#summernote").summernote("code"),content:$("#summernote1").summernote("code"),view:0,deleted:!0,metaHtml:b,viewUrl:$("#urlTopic").val(),imageSrc:$("#urlImage").val(),metaTitle:$("#metaSeoTitle").val(),metaDescription:$("#metaSeoDescription").val(),metaKeyword:$("#metaKeyWord").val(),metaRobot:$("#metaSeoRobot option:selected").val()}:{id:a,title:$("#titleTopic").val(),introduct:$("#summernote").summernote("code"),content:$("#summernote1").summernote("code"),view:0,deleted:!0,metaHtml:b,viewUrl:$("#urlTopic").val(),imageSrc:$("#urlImage").val(),metaTitle:$("#metaSeoTitle").val(),metaDescription:$("#metaSeoDescription").val(),metaKeyword:$("#metaKeyWord").val(),metaRobot:$("#metaSeoRobot option:selected").val()},console.log(c),ajaxCallPost("topic/save/"+f+"/"+$("#courseOfTopic option:selected").val(),c).then(a=>{if(alertSuccess("L\u01B0u b\xE0i vi\u1EBFt th\xE0nh c\xF4ng"),console.log(a),e=a.data.id,null!=d&&""!=$("#tagTopic").val()){$("#tagTopic").css({border:"1px solid #ccc"});for(let a=1;a<d.length;a++)console.log(d[a]),ajaxCallGet("tag/find-by-name?name="+d[a]).then(a=>{console.log(a),ajaxCallPost("topic-has-tag/save/"+e+"/"+a.data.id).then(a=>{console.log(a),$("#postTopic").prop("disabled",!1)}).catch(()=>{$("#btnEditTopic").prop("disabled",!0)})}).catch(b=>{if(null==b.responseJSON.data){let b={name:d[a],deleted:!0};ajaxCallPost("tag/save",b).then(a=>{console.log(a),ajaxCallPost("topic-has-tag/save/"+e+"/"+a.data.id).then(a=>{console.log(a),$("#postTopic").prop("disabled",!1)}).catch(()=>{$("#btnEditTopic").prop("disabled",!0)})})}else console.log("c\xF3 data")});showFullTopic()}else;}).catch(()=>{alertDanger("L\u01B0u b\xE0i vi\u1EBFt th\u1EA5t b\u1EA1i")}),console.log(e)}function getSeoTopic(){let a=`<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="content-style-type" content="text/css">
    <meta http-equiv="content-language" content="en-vi">
    <meta name="copyright" content="spec.edu.vn">
    <meta name="keywords" content="${$("#metaKeyWord").val()}">
    <meta name="description" content="${$("#metaSeoDescription").val()}">
    <meta property="og:site_name" content="spec.edu.vn">
    <meta property="og:type" content="website">
    <meta property="og:title" content="${$("#metaSeoTitle").val()}">
    <meta property="og:description" content="${$("#metaSeoDescription").val()}">
    <meta property="og:url" content="${window.location}">
    <meta name=”robots” content=”${$("#metaSeoRobot option:selected").val()}” >
    <meta name="author" content="SpecEdu">
    <meta name="googlebot" content="index,follow,archive">
    <meta property="og:type" content="article">`;return a}function hideShowBlockAddTopic(){$(".btn-show-add-topic").click(function(){$("#block-edit-topic").show("slow")}),$(".btn-hide-add-topic").click(function(){$("#block-edit-topic").hide("slow")})}function topicData(a){let b=``;a.data.map((a,c)=>{b+=`
             <tr>
                        <td>${c+1}</td>
                        <td><a href="${URL_HTTP+" detail-topic/"+a.id+"/"+a.viewUrl}" target=“_blank”>${a.title}</a> </td>
                     
                        <td><span class="tag tag-success">${a.createDate}</span></td>
                       
                        <td>
                            <div class="mailbox-controls">
                                <!-- Check all button -->
                                <div class="btn-group">
                                    <button id="editTopic${c}" data-id="${a.id}" data-toggle="" title="Sửa" type="button"
                                            class="btn btn-default btn-sm btn-show-add-topic">
                                        <i class="fas fa-wrench"></i>
                                    </button>

                                    <button title="Xóa" onclick="removeTopic(${a.id})" type="button" class="btn btn-default btn-sm">
                                        <i class="far fa-trash-alt"></i>
                                    </button>

                                </div>
                                <!-- /.btn-group -->

                            </div>
                        </td>
                    </tr>
            `}),$("#tableShowAllTopic").html(b),hideShowBlockAddTopic(),saveEditTopic(getItemLocalStorage("lengthTopic"))}function showFullTopic(){ajaxCallGet("topic/find-all").then(a=>{console.log(a.data.length),0<a.data.length?(topicData(a),setItemLocalStorage("lengthTopic",a.data.length)):alertDanger("Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3 t\xECm ki\u1EBFm")}).catch(()=>{alertDanger("Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3 t\xECm ki\u1EBFm")})}function searchTopic(){ajaxCallGet("topic/find-by-title/"+$("#inputSearchTopic").val()).then(a=>{console.log(a),0<a.data.length?topicData(a):alertDanger("Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3 t\xECm ki\u1EBFm")}).catch(()=>{alertDanger("Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3 t\xECm ki\u1EBFm")})}function editTopic(a){$("#postTopic").css({display:"none"}),$("#postTopic").prop("disabled",!0),$("#btnEditTopic").css({display:"inline"}),$("#btnEditTopic").prop("disabled",!1);$("#postTopic").prop("disabled",!1),ajaxCallGet("topic/find-by-idtopic/"+a).then(a=>{console.log(a),$("#titleTopic").val(a.data.title),$("#summernote").summernote("code",a.data.introduct),$("#summernote1").summernote("code",a.data.content),$("#urlTopic").val(a.data.viewUrl),$("#urlImage").val(a.data.imageSrc),$("#viewSeo").summernote("editor.insertText",a.data.metaHtml),$("#metaSeoTitle").val(a.data.metaTitle),$("#metaSeoDescription").val(a.data.metaDescription),$("#metaKeyWord").val(a.data.metaKeyword),$("#metaSeoRobot option:selected").val(a.data.metaRobot)})}function saveEditTopic(a){for(let b=0;b<a;b++)$("#editTopic"+b).click(()=>{editTopic($("#editTopic"+b).attr("data-id")),$("#btnEditTopic").attr("data-id",$("#editTopic"+b).attr("data-id")),$("#btnEditTopic").click(()=>{$("#btnEditTopic").attr("data-id")===$("#editTopic"+b).attr("data-id")&&postTopic($("#btnEditTopic").attr("data-id"))})})}function removeTopic(a){ajaxCallPost("topic/delete/"+a).then(()=>{alertSuccess("X\xF3a th\xE0nh c\xF4ng"),setTimeout(location.reload.bind(location),1500)}).catch(()=>{alertDanger("X\xF3a th\u1EA5t b\u1EA1i")})}function clearDataTopic(){$("#postTopic").css({display:"inline"}),$("#postTopic").prop("disabled",!1),$("#btnEditTopic").css({display:"none"}),$("#btnEditTopic").prop("disabled",!0),$("#titleTopic").val(""),$("#summernote").summernote("code",""),$("#summernote1").summernote("code",""),$("#urlTopic").val(""),$("#urlImage").val(""),$("#viewSeo").summernote("editor.insertText",""),$("#metaSeoTitle").val(""),$("#metaSeoDescription").val(""),$("#metaKeyWord").val("")}